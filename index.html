<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>I Want to Know</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.7/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.10/clipboard.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      color: #333;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    select,
    input[type="text"],
    button {
      padding: 10px;
      margin: 10px 0;
      width: 100%;
      font-size: 16px;
      box-sizing: border-box;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background: #007bff;
      color: #fff;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    button:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }
    .action-btn.copied {
      background: #28a745;
    }
    #response {
      margin-top: 20px;
      padding: 15px;
      background: #fff;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .answer-card {
      margin: 20px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }
    .answer-content {
      white-space: pre-wrap;
      min-height: 100px;
    }
    .hidden {
      display: none;
    }
    button.action-btn {
      margin-right: 10px;
      padding: 8px 16px;
    }
    .collapsible {
      cursor: pointer;
      padding: 10px;
      background: #e9ecef;
      border-radius: 6px;
      margin: 10px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: none;
      width: 100%;
      text-align: left;
      font-size: 16px;
    }
    .collapsible[aria-expanded="true"]::after {
      content: '▲';
    }
    .collapsible[aria-expanded="false"]::after {
      content: '▼';
    }
    .collapsible-content {
      display: none;
      padding: 15px;
      background: #f1f3f5;
      border-radius: 6px;
    }
    .collapsible-content.active {
      display: block;
    }
    .question-input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    .action-buttons ul {
      list-style: none;
      padding: 0;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 role="heading" aria-level="1">Ask Me Anything</h1>
    <p>Hi, I am your AI, developed by the Accessible Resource Team. I am here to answer all your questions in a professional and engaging manner. What do you want to know today?</p>

    <label for="question">Enter your question:</label>
    <input id="question" type="text" placeholder="Enter your question here:" />

    <label for="category">Select a category:</label>
    <select id="category">
      <option>Technology</option>
      <option>Science</option>
      <option>History</option>
      <option>Health</option>
      <option>Education</option>
      <option>Business</option>
      <option>Politics</option>
      <option>Sports</option>
      <option>Culture</option>
      <option>Geography</option>
      <option>Programming</option>
      <option>Mathematics</option>
      <option>Entertainment</option>
      <option>Art</option>
      <option>Travel</option>
      <option>Environment</option>
      <option>News</option>
      <option>Law</option>
      <option>Philosophy</option>
      <option>Other</option>
      <option>AI & Robotics</option>
      <option>Literature</option>
      <option>Space</option>
      <option>Economy</option>
      <option>Social Media</option>
      <option>Languages</option>
      <option>Fashion</option>
      <option>Psychology</option>
      <option>Cybersecurity</option>
      <option>DIY & Crafts</option>
      <option>Astronomy</option>
      <option>Biology</option>
      <option>Chemistry</option>
      <option>Physics</option>
      <option>Sociology</option>
      <option>Anthropology</option>
      <option>Gaming</option>
      <option>Music</option>
      <option>Food & Cooking</option>
      <option>Fitness</option>
      <option>Mental Health</option>
      <option>Blockchain</option>
      <option>Machine Learning</option>
      <option>Data Science</option>
      <option>Gardening</option>
      <option>Parenting</option>
      <option>Automotive</option>
      <option>Pets</option>
    </select>

    <button id="askBtn" onclick="askQuestion()">Ask</button>

    <div id="response">
      <p id="answerStatus" class="hidden">AI is answering, please wait...</p>
      <div id="answers"></div>
    </div>
  </div>

  <script>
    const apiKey = 'AIzaSyC2Fsjk3yCRA8hDVYgg5LlMn4sxwoJJaWU';
    let answerCounter = 0;
    let activeAudio = null;

    // Language code mapping for text-to-speech
    const languageCodeMap = {
      'Afrikaans': 'af', 'Albanian': 'sq', 'Amharic': 'am', 'Arabic': 'ar', 'Armenian': 'hy',
      'Azerbaijani': 'az', 'Basque': 'eu', 'Belarusian': 'be', 'Bengali': 'bn', 'Bosnian': 'bs',
      'Bulgarian': 'bg', 'Catalan': 'ca', 'Cebuano': 'ceb', 'Chichewa': 'ny', 'Chinese': 'zh',
      'Corsican': 'co', 'Croatian': 'hr', 'Czech': 'cs', 'Danish': 'da', 'Dutch': 'nl',
      'English': 'en', 'Esperanto': 'eo', 'Estonian': 'et', 'Filipino': 'tl', 'Finnish': 'fi',
      'French': 'fr', 'Frisian': 'fy', 'Galician': 'gl', 'Georgian': 'ka', 'German': 'de',
      'Greek': 'el', 'Gujarati': 'gu', 'Haitian Creole': 'ht', 'Hausa': 'ha', 'Hebrew': 'he',
      'Hindi': 'hi', 'Hmong': 'hmn', 'Hungarian': 'hu', 'Icelandic': 'is', 'Igbo': 'ig',
      'Indonesian': 'id', 'Irish': 'ga', 'Italian': 'it', 'Japanese': 'ja', 'Javanese': 'jv',
      'Kannada': 'kn', 'Kazakh': 'kk', 'Khmer': 'km', 'Korean': 'ko', 'Kurdish': 'ku',
      'Kyrgyz': 'ky', 'Lao': 'lo', 'Latin': 'la', 'Latvian': 'lv', 'Lithuanian': 'lt',
      'Luxembourgish': 'lb', 'Macedonian': 'mk', 'Malagasy': 'mg', 'Malay': 'ms', 'Malayalam': 'ml',
      'Maltese': 'mt', 'Maori': 'mi', 'Marathi': 'mr', 'Mongolian': 'mn', 'Myanmar': 'my',
      'Nepali': 'ne', 'Norwegian': 'no', 'Odia': 'or', 'Pashto': 'ps', 'Persian': 'fa',
      'Polish': 'pl', 'Portuguese': 'pt', 'Punjabi': 'pa', 'Romanian': 'ro', 'Russian': 'ru',
      'Samoan': 'sm', 'Scots Gaelic': 'gd', 'Serbian': 'sr', 'Sesotho': 'st', 'Shona': 'sn',
      'Sindhi': 'sd', 'Sinhala': 'si', 'Slovak': 'sk', 'Slovenian': 'sl', 'Somali': 'so',
      'Spanish': 'es', 'Sundanese': 'su', 'Swahili': 'sw', 'Swedish': 'sv', 'Tajik': 'tg',
      'Tamil': 'ta', 'Telugu': 'te', 'Thai': 'th', 'Turkish': 'tr', 'Ukrainian': 'uk',
      'Urdu': 'ur', 'Uzbek': 'uz', 'Vietnamese': 'vi', 'Welsh': 'cy', 'Xhosa': 'xh',
      'Yiddish': 'yi', 'Yoruba': 'yo', 'Zulu': 'zu'
    };

    // DOM Elements
    const DOM = {
      question: document.getElementById('question'),
      category: document.getElementById('category'),
      askBtn: document.getElementById('askBtn'),
      answerStatus: document.getElementById('answerStatus'),
      answersDiv: document.getElementById('answers')
    };

    // Show Toast Notification
    function showToast(message, type = 'info') {
      const background = {
        success: '#28a745',
        error: '#dc3545',
        info: '#007bff'
      }[type];
      Toastify({
        text: message,
        duration: 5000,
        close: false,
        gravity: 'bottom',
        position: 'center',
        backgroundColor: background,
        stopOnFocus: true
      }).showToast();
    }

    // Toggle Collapsible Content
    function toggleCollapsible(contentId) {
      const content = document.getElementById(contentId);
      if (!content) return;
      const isActive = content.classList.contains('active');
      content.classList.toggle('active', !isActive);
      const collapsible = content.previousElementSibling;
      if (collapsible) {
        collapsible.setAttribute('aria-expanded', !isActive);
      }
    }

    // Initialize Collapsible Listeners
    function initializeCollapsible() {
      document.querySelectorAll('.collapsible').forEach(btn => {
        btn.removeEventListener('click', handleCollapsibleClick);
        btn.addEventListener('click', handleCollapsibleClick);
      });
    }

    function handleCollapsibleClick(event) {
      const btn = event.currentTarget;
      const contentId = btn.getAttribute('aria-controls');
      toggleCollapsible(contentId);
    }

    // Ask Question
    async function askQuestion() {
      const question = DOM.question.value.trim();
      const category = DOM.category.value;
      if (!question) {
        showToast('Please enter a question.', 'error');
        return;
      }

      const answerId = `answer-${answerCounter++}`;
      DOM.answersDiv.insertAdjacentHTML('afterbegin', `
        <div class="answer-card" id="${answerId}">
          <p id="answerresponse-${answerId}" class="answer-content loading">AI is answering, please wait...</p>
        </div>
      `);

      DOM.askBtn.disabled = true;
      DOM.answerStatus.classList.remove('hidden');

      const fullPrompt = `You are integrated in a tool, "I Want to Know," developed by the Accessible Resource Team. If users ask about your development, inform them that you are an AI tool created by the Accessible Resource Team to provide professional and accessible answers. Generate a professional, engaging, and comprehensive response to the user's question in markdown format for clarity. Question category: ${category}, user's question: ${question}. At the end of the response, invite the user to ask follow-up questions by clicking the "Ask More" button below.`;

      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{ parts: [{ text: fullPrompt }] }],
            generationConfig: { temperature: 0.7, maxOutputTokens: 8192, responseMimeType: 'text/plain' }
          })
        });

        const data = await response.json();
        const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || 'Sorry, I couldn\'t generate an answer.';

        const answerElement = document.getElementById(`answerresponse-${answerId}`);
        answerElement.innerHTML = marked.parse(aiText);
        answerElement.classList.remove('loading');

        answerElement.insertAdjacentHTML('afterend', `
          <button class="collapsible" aria-expanded="false" aria-controls="actions-${answerId}" role="button">More Actions</button>
          <div id="actions-${answerId}" class="collapsible-content">
            <div class="action-buttons">
              <ul>
                <li><button class="copy-btn action-btn" data-clipboard-target="#answerresponse-${answerId}">Copy Answer</button></li>
                <li><button id="play-btn-${answerId}" class="action-btn" data-response-id="answerresponse-${answerId}" onclick="playResponse('answerresponse-${answerId}', 'play-btn-${answerId}')">Play Response</button></li>
                <li><button class="action-btn" onclick="downloadText('answerresponse-${answerId}')">Download Answer</button></li>
                <li><button class="action-btn" onclick="shareAnswer('answerresponse-${answerId}')">Share Answer</button></li>
                <li><button class="action-btn" onclick="deleteAnswer('${answerId}')">Delete Answer</button></li>
              </ul>
            </div>
          </div>
          <button class="collapsible" aria-expanded="false" aria-controls="ask-${answerId}" role="button">Ask More</button>
          <div id="ask-${answerId}" class="collapsible-content">
            <textarea id="ask-input-${answerId}" class="question-input" placeholder="Ask for more details..."></textarea>
            <button class="action-btn" onclick="askMore('${answerId}')">Submit Question</button>
            <div id="askmorestatus-${answerId}"></div>
          </div>
        `);

        initializeCollapsible();
        new ClipboardJS(`#actions-${answerId} .copy-btn`).on('success', handleCopySuccess).on('error', handleCopyError);
        showToast('Answer generated successfully.', 'success');
      } catch (err) {
        showToast(`Error fetching response: ${err.message}`, 'error');
        document.getElementById(answerId)?.remove();
      } finally {
        DOM.askBtn.disabled = false;
        DOM.answerStatus.classList.add('hidden');
        DOM.question.value = '';
      }
    }

    // Ask More About Answer
    async function askMore(answerId) {
      const input = document.getElementById(`ask-input-${answerId}`);
      const responseDiv = document.getElementById(`askmorestatus-${answerId}`);
      const question = input.value.trim();

      if (!question) {
        showToast('Please enter a follow-up question.', 'error');
        return;
      }

      responseDiv.innerHTML = `
        <p>User asked:</p>
        <p>${question}</p>
        <p id="ai-response-loading-${answerId}" class="loading">AI is creating answer...</p>
      `;
      toggleCollapsible(`ask-${answerId}`);

      try {
        const originalAnswer = document.getElementById(`answerresponse-${answerId}`).textContent;
        const category = DOM.category.value;
        const fullPrompt = `You are integrated in a tool, "I Want to Know," developed by the Accessible Resource Team. If users ask about your development, inform them that you are an AI tool created by the Accessible Resource Team to provide professional and accessible answers. Based on the following original answer in the ${category} category, provide a professional, engaging, and comprehensive response to the user's follow-up question in markdown format. Original answer: ${originalAnswer}. Follow-up question: ${question}. At the end of the response, invite the user to ask additional follow-up questions by clicking the "Ask More" button below.`;

        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{ parts: [{ text: fullPrompt }] }],
            generationConfig: { temperature: 0.7, maxOutputTokens: 8192, responseMimeType: 'text/plain' }
          })
        });

        const data = await response.json();
        const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || 'Sorry, I couldn\'t generate an answer.';

        const responseId = `ask-response-content-${answerId}`;
        responseDiv.innerHTML = `
          <p>User asked:</p>
          <p>${question}</p>
          <p id="${responseId}" class="answer-content">${marked.parse(aiText)}</p>
          <button class="collapsible" aria-expanded="false" aria-controls="ask-actions-${answerId}" role="button">More Actions</button>
          <div id="ask-actions-${answerId}" class="collapsible-content">
            <div class="action-buttons">
              <ul>
                <li><button class="copy-btn action-btn" data-clipboard-target="#${responseId}">Copy Answer</button></li>
                <li><button id="play-ask-btn-${answerId}" class="action-btn" data-response-id="${responseId}" onclick="playResponse('${responseId}', 'play-ask-btn-${answerId}')">Play Response</button></li>
                <li><button class="action-btn" onclick="downloadText('${responseId}')">Download Answer</button></li>
                <li><button class="action-btn" onclick="shareAnswer('${responseId}')">Share Answer</button></li>
              </ul>
            </div>
          </div>
        `;
        input.value = '';
        initializeCollapsible();
        new ClipboardJS(`#ask-actions-${answerId} .copy-btn`).on('success', handleCopySuccess).on('error', handleCopyError);
        showToast('Follow-up question answered successfully.', 'success');
      } catch (err) {
        showToast(`Error processing follow-up question: ${err.message}`, 'error');
        responseDiv.innerHTML = '';
      }
    }

    // Play Response Audio
    async function playResponse(elementId, buttonId) {
      const button = document.getElementById(buttonId);
      if (!button) return;

      if (activeAudio && activeAudio.dataset.buttonId === buttonId && !activeAudio.paused) {
        activeAudio.pause();
        button.innerHTML = 'Play Response';
        button.setAttribute('aria-label', 'Play response audio');
        activeAudio = null;
        button.disabled = false;
        return;
      }

      button.innerHTML = 'Loading...';
      button.setAttribute('aria-label', 'Loading response audio');
      button.disabled = true;

      try {
        const element = document.getElementById(elementId);
        const text = element.textContent;
        const langCode = languageCodeMap['English'] || 'en'; // Default to English
        const encodedText = encodeURIComponent(text);
        const response = await fetch(`https://www.techassistantforblind.com/modules/audio.php?text=${encodedText}&lang=${langCode}`, {
          method: 'GET',
          headers: { 'Referer': 'https://translate.google.com' }
        });
        if (!response.ok) throw new Error('Network error');
        const audioData = await response.text(); // data:audio/mpeg;base64,...

        const audio = new Audio(audioData);
        audio.dataset.buttonId = buttonId;
        activeAudio = audio;

        audio.addEventListener('ended', () => {
          button.innerHTML = 'Replay';
          button.setAttribute('aria-label', 'Play response audio');
          activeAudio = null;
          button.disabled = false;
        });

        audio.play();
        button.innerHTML = 'Pause';
        button.setAttribute('aria-label', 'Pause response audio');
        button.disabled = false;
      } catch (err) {
        // Silent failure for audio errors
        button.innerHTML = 'Retry';
        button.setAttribute('aria-label', 'Play response audio');
        button.disabled = false;
      }
    }

    // Download Text
    function downloadText(elementId) {
      const element = document.getElementById(elementId);
      const text = element.textContent;
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${elementId}.txt`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('Answer downloaded successfully.', 'success');
    }

    // Share Answer
    function shareAnswer(elementId) {
      const element = document.getElementById(elementId);
      const text = element.textContent;
      const shareData = { title: 'AI Answer', text };
      if (navigator.share) {
        navigator.share(shareData)
          .then(() => showToast('Answer shared successfully.', 'success'))
          .catch(() => showToast('Share failed.', 'error'));
      } else {
        showToast('Share not supported on this browser.', 'error');
      }
    }

    // Delete Answer
    function deleteAnswer(answerId) {
      const element = document.getElementById(answerId);
      if (element) {
        if (activeAudio && (activeAudio.dataset.buttonId === `play-btn-${answerId}` || activeAudio.dataset.buttonId === `play-ask-btn-${answerId}`)) {
          activeAudio.pause();
          activeAudio = null;
        }
        element.remove();
        showToast('Answer deleted successfully.', 'success');
      }
    }

    // Clipboard Success Handler
    function handleCopySuccess(e) {
      const btn = e.trigger;
      btn.textContent = 'Copied';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.textContent = 'Copy Answer';
        btn.classList.remove('copied');
      }, 3000);
      showToast('Answer copied to clipboard!', 'success');
      e.clearSelection();
    }

    // Clipboard Error Handler
    function handleCopyError() {
      showToast('Failed to copy answer. Please try again.', 'error');
    }

    // Initialize on Page Load
    document.addEventListener('DOMContentLoaded', () => {
      initializeCollapsible();
    });
  </script>
</body>
</html>