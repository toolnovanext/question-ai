<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question AI</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-color: #f4f7f9;
            --chat-background: #ffffff;
            --user-msg-bg: #e1f5fe;
            --ai-msg-bg: #f8f9fa;
            --text-color: #333;
            --border-color: #e0e0e0;
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            margin: 0;
            padding: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text-color);
        }

        .chat-container {
            width: 100%;
            max-width: 800px;
            height: 90vh;
            background: var(--chat-background);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--primary-color);
            color: white;
        }

        .chat-header h1 {
            margin: 0;
            font-size: 1.5rem;
        }

        #deleteChatBtn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }

        #deleteChatBtn:hover {
            background: #c82333;
        }

        .chat-area {
            flex-grow: 1;
            padding: 1.5rem;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .message-pair {
            margin-bottom: 1.5rem;
        }
        
        .message-pair h2 {
            font-size: 0.9rem;
            color: var(--secondary-color);
            margin: 0 0 0.5rem;
            font-weight: 500;
        }

        .message-content {
            padding: 1rem;
            border-radius: var(--border-radius);
            max-width: 90%;
            word-wrap: break-word;
        }

        .user-message .message-content {
            background: var(--user-msg-bg);
            margin-left: auto;
            text-align: right;
        }
        
        .ai-message .message-content {
            background: var(--ai-msg-bg);
            border: 1px solid var(--border-color);
            margin-right: auto;
        }

        .ai-message .message-content p:last-child {
            margin-bottom: 0;
        }
        
        .loading-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .loading-indicator span {
            display: inline-block;
            width: 10px;
            height: 10px;
            background-color: var(--secondary-color);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loading-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .loading-indicator span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }

        .chat-input-area {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
            background: var(--chat-background);
        }

        .chat-input-area form {
            display: flex;
            gap: 0.75rem;
        }

        #userInput {
            flex-grow: 1;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            font-size: 1rem;
            resize: none;
        }

        #userInput:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        #askBtn {
            padding: 0.75rem 1.25rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #askBtn:hover:not(:disabled) {
            background: #0056b3;
        }

        #askBtn:disabled {
            background: var(--secondary-color);
            cursor: not-allowed;
        }
        
        /* Collapsible Actions */
        .collapsible {
            cursor: pointer;
            padding: 0.6rem 1rem;
            background: #e9ecef;
            border-radius: 8px;
            margin-top: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: none;
            width: 100%;
            text-align: left;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .collapsible[aria-expanded="true"]::after { content: '▲'; }
        .collapsible[aria-expanded="false"]::after { content: '▼'; }

        .collapsible-content {
            display: none;
            padding: 1rem;
            background: #f1f3f5;
            border-radius: 8px;
            margin-top: 0.5rem;
        }
        
        .collapsible-content.active { display: block; }

        .action-buttons ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: 1px solid var(--secondary-color);
            background-color: transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background-color: var(--secondary-color);
            color: white;
        }

        .action-btn.copied {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="chat-container">
        <header class="chat-header">
            <h1>Question AI</h1>
            <button id="deleteChatBtn" class="hidden">Delete Chat</button>
        </header>

        <main id="chatArea" class="chat-area"></main>

        <footer class="chat-input-area">
            <form id="chatForm">
                <input type="text" id="userInput" placeholder="Ask me anything..." autocomplete="off" required>
                <button id="askBtn" type="submit">Submit</button>
            </form>
        </footer>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- CONFIGURATION ---
        const API_KEY = 'YOUR_API_KEY'; // IMPORTANT: Replace with your actual Gemini API key
        const MODEL_NAME = 'gemini-1.5-flash';

        // --- DOM ELEMENTS ---
        const DOM = {
            chatForm: document.getElementById('chatForm'),
            userInput: document.getElementById('userInput'),
            askBtn: document.getElementById('askBtn'),
            chatArea: document.getElementById('chatArea'),
            deleteChatBtn: document.getElementById('deleteChatBtn'),
        };

        // --- STATE MANAGEMENT ---
        let messageCounter = 0;
        let activeAudio = null;

        const systemInstruction = {
            parts: [{
                text: `You are Question AI, an AI assistant integrated into a tool developed by the Accessible Resource Team.
- Your goal is to provide professional, engaging, accessible, and comprehensive answers.
- Format all your responses using markdown for clarity.
- If users ask about your development, inform them that you are an AI tool created by the Accessible Resource Team.
- Your primary function is to answer general and daily questions.
- If a user asks for advanced tasks you cannot perform (like image generation, web searches, file summarization, or transcription), politely state that you are designed for general conversational solutions and suggest they try accessible resource AI for those features.`
            }]
        };

        // --- UTILITY FUNCTIONS ---
        const showToast = (message, type = 'info') => {
            const backgroundColors = { success: '#28a745', error: '#dc3545', info: '#007bff' };
            Toastify({
                text: message,
                duration: 4000,
                close: true,
                gravity: 'bottom',
                position: 'center',
                backgroundColor: backgroundColors[type],
                stopOnFocus: true
            }).showToast();
        };

        const scrollToBottom = () => {
            DOM.chatArea.scrollTop = DOM.chatArea.scrollHeight;
        };

        // --- CORE CHAT LOGIC ---
        const handleFormSubmit = async (event) => {
            event.preventDefault();
            const userQuestion = DOM.userInput.value.trim();

            if (!userQuestion) {
                showToast('Please enter a question.', 'error');
                return;
            }

            if (API_KEY === 'Y') {
                showToast('invalid key.', 'error');
                return;
            }

            setLoadingState(true);
            const currentId = messageCounter++;
            displayMessage(userQuestion, 'user', currentId);
            const aiMessageElement = displayMessage('', 'ai', currentId);
            scrollToBottom();

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userQuestion }] }],
                        system_instruction: systemInstruction,
                        generationConfig: { temperature: 1.7, maxOutputTokens: 8192 }
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Failed to fetch response.');
                }

                const data = await response.json();
                const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || 'Sorry, I couldn\'t generate a valid answer.';
                
                updateAiMessage(aiMessageElement, aiText, currentId);

            } catch (error) {
                const errorMessage = `Error: ${error.message}`;
                updateAiMessage(aiMessageElement, errorMessage, currentId, true);
                showToast(errorMessage, 'error');
            } finally {
                setLoadingState(false);
                DOM.deleteChatBtn.classList.remove('hidden');
                scrollToBottom();
            }
        };
        
        const setLoadingState = (isLoading) => {
            DOM.userInput.disabled = isLoading;
            DOM.askBtn.disabled = isLoading;
            DOM.askBtn.textContent = isLoading ? 'Thinking...' : 'Submit';
            if (!isLoading) {
                DOM.userInput.value = '';
                DOM.userInput.focus();
            }
        };

        const displayMessage = (text, role, id) => {
            const messagePair = document.createElement('div');
            messagePair.id = `message-pair-${id}`;
            messagePair.className = 'message-pair';

            const messageWrapper = document.createElement('div');
            messageWrapper.className = `${role}-message`;
            
            const title = document.createElement('h2');
            title.textContent = role === 'user' ? 'You Asked' : 'AI Said';

            const contentWrapper = document.createElement('div');
            contentWrapper.className = 'message-content';
            
            if (role === 'ai' && !text) {
                contentWrapper.innerHTML = `
                    <div class="loading-indicator">
                        <span></span><span></span><span></span>
                    </div>`;
            } else {
                contentWrapper.textContent = text;
            }

            messageWrapper.append(title, contentWrapper);
            messagePair.appendChild(messageWrapper);
            DOM.chatArea.appendChild(messagePair);
            
            return messagePair;
        };

        const updateAiMessage = (messagePairElement, text, id, isError = false) => {
            const aiMessageContainer = messagePairElement.querySelector('.ai-message .message-content');
            if (!aiMessageContainer) return;

            aiMessageContainer.innerHTML = marked.parse(text);
            if(isError) aiMessageContainer.style.color = 'red';

            const actionsHtml = `
                <button class="collapsible" aria-expanded="false" aria-controls="actions-${id}" role="button">Actions</button>
                <div id="actions-${id}" class="collapsible-content">
                    <div class="action-buttons">
                        <ul>
                            <li><button class="action-btn copy-btn" data-clipboard-target="#ai-response-${id}">Copy</button></li>
                            <li><button class="action-btn play-btn" data-target-id="ai-response-${id}">Play</button></li>
                            <li><button class="action-btn download-btn" data-target-id="ai-response-${id}">Download</button></li>
                            <li><button class="action-btn share-btn" data-target-id="ai-response-${id}">Share</button></li>
                        </ul>
                    </div>
                </div>
            `;
            
            // Add a wrapper with an ID for clipboard and other actions
            aiMessageContainer.id = `ai-response-${id}`;
            messagePairElement.querySelector('.ai-message').insertAdjacentHTML('beforeend', actionsHtml);
            
            // Initialize ClipboardJS for the new button
            new ClipboardJS(`.copy-btn[data-clipboard-target="#ai-response-${id}"]`)
                .on('success', handleCopySuccess)
                .on('error', () => showToast('Failed to copy.', 'error'));
        };

        // --- ACTION HANDLERS (EVENT DELEGATION) ---
        const handleChatAreaClick = (event) => {
            const target = event.target;
            
            if (target.matches('.collapsible')) {
                const contentId = target.getAttribute('aria-controls');
                const content = document.getElementById(contentId);
                const isExpanded = target.getAttribute('aria-expanded') === 'true';
                content.classList.toggle('active', !isExpanded);
                target.setAttribute('aria-expanded', !isExpanded);
            }
            
            const responseId = target.dataset.targetId;
            if (!responseId) return;

            const responseElement = document.getElementById(responseId);
            if (!responseElement) return;
            
            if (target.matches('.play-btn')) playResponse(responseElement.textContent, target);
            if (target.matches('.download-btn')) downloadText(responseElement.textContent, responseId);
            if (target.matches('.share-btn')) shareAnswer(responseElement.textContent);
        };
        
        const handleCopySuccess = (e) => {
            const btn = e.trigger;
            btn.textContent = 'Copied!';
            btn.classList.add('copied');
            setTimeout(() => {
                btn.textContent = 'Copy';
                btn.classList.remove('copied');
            }, 2000);
            showToast('Answer copied to clipboard!', 'success');
            e.clearSelection();
        };

        const playResponse = async (text, button) => {
            if (activeAudio && !activeAudio.paused) {
                activeAudio.pause();
                if (activeAudio.dataset.buttonId === button.id) {
                    activeAudio = null;
                    return;
                }
            }
            
            button.textContent = 'Loading...';
            button.disabled = true;
            
            try {
                const encodedText = encodeURIComponent(text);
                const ttsUrl = `https://www.techassistantforblind.com/modules/audio.php?text=${encodedText}&lang=en`;
                const audio = new Audio(ttsUrl);
                activeAudio = audio;
                
                audio.play();
                button.textContent = 'Pause';
                
                audio.onended = () => { button.textContent = 'Play'; activeAudio = null; };
                audio.onpause = () => { button.textContent = 'Play'; };
                
            } catch (err) {
                showToast('Could not play audio.', 'error');
                button.textContent = 'Play';
            } finally {
                button.disabled = false;
            }
        };
        
        const downloadText = (text, id) => {
            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `question-ai-answer-${id}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast('Answer downloaded.', 'success');
        };

        const shareAnswer = (text) => {
            if (navigator.share) {
                navigator.share({ title: 'Answer from Question AI', text: text })
                    .then(() => showToast('Answer shared.', 'success'))
                    .catch(() => showToast('Sharing was cancelled or failed.', 'error'));
            } else {
                showToast('Web Share API is not supported in your browser.', 'error');
            }
        };
        
        const deleteChat = () => {
             if (confirm('Are you sure you want to delete the entire chat?')) {
                DOM.chatArea.innerHTML = '';
                DOM.deleteChatBtn.classList.add('hidden');
                if(activeAudio) activeAudio.pause();
                activeAudio = null;
                messageCounter = 0;
                showToast('Chat deleted.', 'success');
             }
        };

        // --- INITIALIZATION ---
        DOM.chatForm.addEventListener('submit', handleFormSubmit);
        DOM.chatArea.addEventListener('click', handleChatAreaClick);
        DOM.deleteChatBtn.addEventListener('click', deleteChat);
    });
    </script>
</body>
</html>